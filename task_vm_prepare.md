## Подготовка виртуальной машины для работы с системой управления проектами

### Создание клона подготовленной виртуальной машины
1. Открыть приложение VMWare Workstation, выбрать пункт меню "открыть виртуальную машину" (File-Open). Найти и выбрать для открытия виртуальную машину, расположенную в каталоге "D:\Виртуалки учебные", **Ubuntu 18.04 v3** (Файл с расширением vmx в соответствующем каталоге). Возможно наличие более свежей версии.

2. Выбрать пункт клонирования виртуальной машины (VM-Manage-Clone). В процессе создания выбирать значения по умолчанию. Обратите внимание что необходимо создавать свзанный клон виртуальной машины (Linked Clone). Название виртуальной машины можно изменить. Для понимания: связанный клон, не может работать без исходной виртуальной машины. Связанный клон хранит в себе только изменения относительно исходной виртуальной машины, следовательно, он занимает мало места на жестком диске.

3. Проверить и при необходимости Изменить настройки процессоров и памяти виртуальной машины - память минимум 4096 Мб, установить 1 процессор, 4 ядра.

3. Пользователь ОС Ubuntu - user, пароль - user.

4. Для удобства дальнейшей работы необходимо перевести виртуальную машину в полноэкранный режим (сочетание клавиш Ctrl-Alt-Enter или через меню), открыть браузер в виртуальной машине и открыть данную страницу в нем.

### Настройка связи Ubuntu и gitwork.ru
1. Проверка связи с gitwork.ru в виртуальной машине

   Проверьте работоспособность связи командой 
    
   ```bash
   ping gitwork.ru
   ```
   
   Успешный результат выглядит примерно так (IP-адрес может отличаться)
   
   ```bash
   PING gitwork.ru (10.0.10.56) 56(84) bytes of data.
   64 bytes from gitwork.ru (10.0.10.56): icmp_req=1 ttl=64 time=0.744 ms
   64 bytes from gitwork.ru (10.0.10.56): icmp_req=2 ttl=64 time=1.19 ms
   64 bytes from gitwork.ru (10.0.10.56): icmp_req=3 ttl=64 time=1.01 ms
   ```
    
   Для прерывания бесконечного процесса нажмитие Ctrl-C
   
   При успешной связи переходите к созданию ssh-ключа, в противном случае проведите следующие действия
    
   Периодически в классах возникают проблемы по связи с gitwork.ru, чтобы их предупредить необходимо зафиксировать жестко соответствие IP-адреса и имени gitwork.ru 

   Для этого в консоли (Terminator) выполните команду

    ```bash
    sudo nano /etc/hosts
    ```
    
    Введите пароль 'user'. 
    
    В редакторе у вас откроется файл, в котором указывается соответствие имен и IP-адресов.
    
    На пустой строке (обычно третья) впишите тот IP-адрес, который вам выдало ранее при команде  ping, например 10.0.10.56 или 192.168.64.246

    ```bash
    10.0.10.56 gitwork.ru
    ```
    
    Нужный IP зависит от сети, в которой вы работаете, уточните у преподавателя. В хостовой ОС можно в консоли выполнить ping gitwork.ru и посмотреть IP в выводе (например, 192.168.64.246);
    Сохраните файл, для этого нажмите Ctrl-S (сохранение) и Ctrl-X (выход) 
    
    Проверьте работоспособность связи командой 
    
    ```bash
    ping gitwork.ru
    ```
    
    Успешный результат выглядит примерно так
    
    ```bash
    PING gitwork.ru (10.0.10.56) 56(84) bytes of data.
    64 bytes from gitwork.ru (10.0.10.56): icmp_req=1 ttl=64 time=0.744 ms
    64 bytes from gitwork.ru (10.0.10.56): icmp_req=2 ttl=64 time=1.19 ms
    64 bytes from gitwork.ru (10.0.10.56): icmp_req=3 ttl=64 time=1.01 ms
    ```
    
    Для прерывания бесконечного процесса нажмитие Ctrl-C
1. Создание SSH-ключа (SSH-ключ необходим для беспарольного взаимодействия виртуальной машины и сервера gitwork.ru)
    * В консоли выполнить 

    ```bash
    ssh-keygen
    ```
    * Внимательно прочитать вывод, нажать enter на каждый вариант. (При нажатии enter используется значение по умолчанию, предлагаемое в скобках, это общая практика для Linux систем).
    * Пароль не вводить (оставить пустым), в противном случае будет включена двухфакторная авторизация, что в дальнейшем потребует подтверждения любого действия с репозиторием путем ввода пароля.
    * По указанному на первом шаге пути будет лежать ключ, если все значения были выбраны по умолчанию, то он будет лежать в домашнем каталоге, в подкаталоге .ssh
    * Выполнить

    ```bash
    cat ~/.ssh/id_rsa.pub
    ```
    * Полученный вывод (ваш открытый ключ, от начала и до конца) скопировать в настройки учетной записи в gitwork.ru (справа сверху - settings, в меню слева SSH keys, скопировать ключ в key, указать в title название по шаблону ubuntu_аудитория_компьютер, например, ubuntu_113_01 - при наличии такого ключа можно знать, что из 113 аудитории с компьютера 01 доступ есть), убедиться в корректном добавлении ключа;
    * Есть 3 способа копирования из консоли. Это правой кнопкой мыши, copy - paste. Это комбинация ctrl+shift+c, ctrl+shift+v. И это использования буфера выделения - весь выделенный текст автоматически копируется. Вставка по нажатию колесика мыши.
    * После этого gitwork.ru знает вас как владельца соответствующих ssh-сертификатов. Следующей командой убедитесь, что gitwork.ru может узнать ваш full name
    
    ```bash
    ssh -T git@gitwork.ru
    # на вопрос ответьте yes (при первом использовании ключа спрашивается доверяете ли вы удаленному компьютеру)
    ```
    Если в консоли получен верный ваш username, то всё с ssh сделано правильно.
    
### Создание копии репозитория
1. Открыть терминал на рабочем столе. Результат выполнения команды **pwd** (узнать текущий каталог) должен писать /home/user/. 
2. Имзмените текущий каталог на Desktop (Рабочий стол), для этого выполните команду:

    ```bash
    cd Desktop
    ```
    
     ```bash
    Лирическое отсутпление про смену каталогов
    
    Узнать текущий каталог можно командой
    pwd
    
    Перейти в каталог /home/user/Desktop/tpro, это путь к каталогу вашего проекта по умолчанию для данного задания
    cd /home/user/Desktop/tpro
    
    Перейти в подкаталог test текущего каталога
    cd test
    
    Получить содержимое каталога со скрытиыми файлами
    ls -la
     ```
     
    Указанные далее команды позволяют скопировать ваш проект (репозиторий) с сервера gitwork.ru. Необходимо использовать **свои данные**, а не указанные ниже, это пример. 

    ```bash
    # настройки локального git - ваше имя пользователя и почта. Используйте логин (name) из gitwork.ru вместо "ваш_логин". 
    git config --global user.name "ваш_логин"
    git config --global user.email "ваш_логин@gitwork.ru"
    ```
    
    Если у вас есть предпочитаемый редактор в Linux, то можете установить редактор по умолчанию, который будет вызываться каждый раз, когда от вас потребуется информация по commit или редактирование файлов. По умолчанию это редактор VIM. 
    
    Проверить установку текущего редактора (а также другие настройки) можно выполнив команду
    
    ```bash
    git config --list
    ```
    Параметр, отвечающий за формат отображения имен файлов это **core.quotepath**
    
    По умолчанию он включен (true) - при этом русские имена файлов отображаются в виде кодов символов таблицы Unicode, что не совсем удобно, если хочется получить русские имена файлов и удобно с ними работать необходимо выполнить команду
    
    ```bash
    git config --global core.quotepath false
    ```
    
    Параметр, отвечающий за редактор по умолчанию это **core.editor**
    
    Если вы хотите установить любой другой редактор, например nano, то необходимо выполнить
    
    ```bash
    git config --global core.editor nano
    ```
    Либо оставить все как есть. 
    
    ```bash
    Лирическое отсутпление про VIM.
    
    Редактор имеет несколько режимов работы, от режима работы зависит как меняется редактируемый файл.
    
    В обычном режиме, который включен изначально вы не можете изменять файл, так как вы привыкли в любом другом редакторе - при нажатии определенного символа, данный символ не будет введен, а произойдет то или иное действие.
    
    Наиболее важный режим - это редактирование, он включается, если в обычном режиме нажать клавишу i (от слова INSERT), находясь в этом режиме можно редактировать файл в привычном режиме. Сигнализация о том, что вы находитесь в режиме редактирования является надпись внизу экрана --INSERT--. Выйти из режима можно клавишей ESC
    
    Выйти с сохранением - в обычном режиме нажать Shift-Z-Z
    
    Выйти без сохранения - В обычном режиме ввести :q! <ENTER>
    
    Этих действий будет вам достаточно для ввода информации о commitе - Последовательность действий: i - Редактирование - ESC - Shift-Z-Z
    
    Понимание основных команд по работе с редактором VIM можно получить выполнив команду,
    
    vimtutor ru
    ```
    Теперь непосредственно можно производить копирование репозитория командой
    
    ```bash
    git clone ssh://git@gitwork.ru/ваш_логин/tpro.git
    ```
3. Возможно будет выдан запрос, доверяете ли вы неизвестному хосту (The authenticity of host '[gitwork.ru]' can't be established.) - противодействие атаке "третий посередине" или man in the middle. Введите yes.
4. На рабочем столе появился каталог tpro с содержимым вашего репозитория; Выполните
    
    ```bash
    cd tpro
    cat README.md
    ```
**Если возникла ошибка при работе с файлом README.md**, возможно файл называется-по другому: readme.md, Readme.md, README.md это зависит от того, как у вас создавался проект на первом занятии, проверьте через веб-интерфейс и в дальнейшем вводите такое имя файла, какое у вас в репозитории.

5. Убедитесь, что на экране ваш репозиторий.
Для того чтобы перемещаться в репозитории выше по уровню (вернуться в Desktop из tpro) используйте команду
    ```bash
    cd ..
    ```
## Работа в git
1. **Проверка статуса проекта и синхронизация репозиториев**
    * В консоли выполните

    ```bash
    # вы должны быть в каталоге /home/user/Desktop/tpro
    git status
    ```    
    * Красным отмечены неотслеживаемые файлы - git за ними не следит. Файлы, указанные в .gitignore (найдите файл в каталогах проекта) не отображаются - их git игнорирует.
    * Через редактор измените файл README.md, добавьте в конец строку "новые изменения" 
    
    ```bash
    nano README.md
    ```
    
    * В консоли наберите (указанный код зафиксирует и загрузит только файл README.md)
    
    ```bash
    git add README.md
    git commit -m 'изменен README.md через UBUNTU'
    git push origin master
    ```
    * Если забудете указать параметр -m в команде commit то будет вызван редактор по умолчанию для описания коммита, необходимо вписать туда текст и сохранить.
    * Проверьте через веб-интерфейс, что правки теперь есть и на сервере;
   
1. **Если добавили лишнее**
    
    Если вы случайно или ошибочно добавили (проиндексировали) файлы, которые не должны быть в проекте, например, если у вас не правильно был настроен файл .gitignore, то отменить результат команды git add можно следующей командой

    ```bash
    git rm --cached FILENAME
    # убирает файл из области индексации, файл снова становится untracked
    # использование rm без ключа --cached полностью удалит файл с диска
    # ключ -r - (recursive) рекурсивно для подкаталогов и файлов в них
    # ключ -f - (force) в случае защиты файлов
    ```
    
1. **Перепроверить!**    
    **Самая распространенная ошибка** - это наличие в проекте временных файлов среды разработки - каталогов **".idea"** и **"cmake-build-debug"**. Устранить это можно так как описано выше, при наличии таких каталогов в проекте **оценка будет снижаться**.

    
1. **Выполнение заданий**

Вы должны четко понимать где находится актуальная (последняя) копия вашего проекта:

* на сервере gitwork.ru
* на виртуальной машине
* на носителе (если взяли код через администраторов доделать дома)

Идеальное состояние когда в промежутках между занятиями актуальная копия вашего проекта находится на сервере. Это позволяет вам начать следующее занятие с той же точки в любой аудитории на любом компьютере, либо подойти к преподавателю и показать исходный код.

Для достижения такого состояния необходимо каждое занятие начинать с команды **git pull** (забрать проект) и заканчивать командой **git push** (отдать проект). Если вы работаете на новой виртуальной машине, то вместо команды pull будет clone.

Необходимо добиваться успешного выполнения указанных команд и реагировать на все выводимые ошибки.

### Если новое занятие начинается в новом классе, на новом компьютере, или из под учетной записи другого пользователя необходимо заново настроить виртуальную машину:
* проверить настройки процессоров и памяти виртуальной машины
* проверить и при необходимости настроить доступность gitwork.ru (/etc/hosts)
* сгенерировать ssh ключ и прописать его в настройках https://gitwork.ru
* сконфигурировать git окружение **git config**
* забрать проект с сервера командой **git clone** или (если проект уже есть) обновить его командой **git pull**
* по окончанию занятия загрузить проект на сервер командой **git push** (можно загружать и в процессе занятия, но по окончанию обязательно - следующее занятие может проходить в другом классе)
 
Подробный синтаксис команд см. выше.

### P.S.

Подробнее информацию по командам и состояниям файлов можно найти в файлах [git_short.md](https://gitwork.ru/sub/tpro/-/blob/master/git_short.md), [git_full.md](https://gitwork.ru/sub/tpro/-/blob/master/git_full.md), рисунках [Состояния Git (начальное представление)](https://gitwork.ru/sub/tpro/-/blob/master/wiki/%D0%A1%D0%BE%D1%81%D1%82%D0%BE%D1%8F%D0%BD%D0%B8%D1%8F_GIT_-_simpliest.jpg), [Состояния Git кратко](https://gitwork.ru/sub/tpro/-/blob/master/wiki/%D0%A1%D0%BE%D1%81%D1%82%D0%BE%D1%8F%D0%BD%D0%B8%D1%8F_GIT_-_simple.jpg), [Состояния Git подробно](https://gitwork.ru/sub/tpro/-/blob/master/wiki/%D0%A1%D0%BE%D1%81%D1%82%D0%BE%D1%8F%D0%BD%D0%B8%D1%8F%20GIT_-_full.jpg). Wiki [Состояния Git](https://gitwork.ru/sub/tpro/-/blob/master/wiki/%D0%A1%D0%BE%D1%81%D1%82%D0%BE%D1%8F%D0%BD%D0%B8%D1%8F_GIT.md). Ну или более полная инфомрация может быть найдена в книгах [PROGIT](https://gitwork.ru/sub/tpro/-/blob/master/wiki/%D0%91%D0%B8%D0%B1%D0%BB%D0%B8%D0%BE%D1%82%D0%B5%D0%BA%D0%B0/Git/progit_v2.1.84.pdf) и [Чакон.С Git для профессионального программиста](https://gitwork.ru/sub/tpro/-/blob/master/wiki/%D0%91%D0%B8%D0%B1%D0%BB%D0%B8%D0%BE%D1%82%D0%B5%D0%BA%D0%B0/Git/Git%20%D0%B4%D0%BB%D1%8F%20%D0%BF%D1%80%D0%BE%D1%84%D0%B5%D1%81%D1%81%D0%B8%D0%BE%D0%BD%D0%B0%D0%BB%D1%8C%D0%BD%D0%BE%D0%B3%D0%BE%20%D0%BF%D1%80%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%B8%D1%81%D1%82%D0%B0.pdf). Все это есть в данном проекте

